<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Sistema PIX - CNH Social</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #1351B4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0c326f;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #1351B4;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        .success {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        #console-output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste do Sistema PIX - CNH Social</h1>

    <div class="test-section">
        <h2>1. Teste B√°sico - Fun√ß√£o generatePixPayment</h2>
        <p>Testa a cria√ß√£o inicial de uma transa√ß√£o PIX.</p>
        <button class="test-button" onclick="testGeneratePixPayment()">Executar Teste</button>
        <div id="test1-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>2. Teste de Retry - Fun√ß√£o fetchPixDetails</h2>
        <p>Testa o sistema de retry autom√°tico com fallback.</p>
        <button class="test-button" onclick="testFetchPixDetails()">Executar Teste</button>
        <div id="test2-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>3. Teste de Fallback - Sistema Alternativo</h2>
        <p>Testa a gera√ß√£o de PIX alternativo quando a API falha.</p>
        <button class="test-button" onclick="testFallbackPix()">Executar Teste</button>
        <div id="test3-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>4. Teste do Modal PIX</h2>
        <p>Testa a exibi√ß√£o completa do modal com QR Code e funcionalidades.</p>
        <button class="test-button" onclick="testShowPixModal()">Executar Teste</button>
        <div id="test4-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>üöÄ Teste Completo - Executar Todos os Testes</h2>
        <p>Executa todos os testes do sistema PIX automaticamente.</p>
        <button class="test-button" onclick="runAllTests()" style="background: #28a745;">Executar Todos os Testes</button>
        <div id="all-tests-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
        <h2>Console de Debug</h2>
        <div id="console-output"></div>
        <button class="test-button" onclick="clearConsole()" style="background: #666;">Limpar Console</button>
    </div>

    <!-- Carregar os scripts do projeto -->
    <script src="js/polyfills-42372ed130431b0a.js"></script>
    <script src="js/webpack-305449aa8c860d36.js"></script>
    <script src="js/11eacf67-98aa3283aaa991d2.js"></script>
    <script src="js/954-f99233729901dfd9.js"></script>
    <script src="js/main-app-b38dfe386f18af4f.js"></script>
    <script src="js/528-e741b123adcbdc87.js"></script>
    <script src="js/page-2194861fd18157c8.js"></script>
    <script src="test-results-saver.js"></script>

    <script>
        // Sistema de logging personalizado
        let consoleLogs = [];
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            consoleLogs.push(['log', ...args]);
            originalLog.apply(console, args);
            updateConsole();
        };

        console.error = function(...args) {
            consoleLogs.push(['error', ...args]);
            originalError.apply(console, args);
            updateConsole();
        };

        console.warn = function(...args) {
            consoleLogs.push(['warn', ...args]);
            originalWarn.apply(console, args);
            updateConsole();
        };

        function updateConsole() {
            const output = document.getElementById('console-output');
            output.innerHTML = consoleLogs.map(([type, ...args]) => {
                const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffd93d' : '#74b9ff';
                return `<span style="color: ${color}">[${type.toUpperCase()}]</span> ${args.join(' ')}`;
            }).join('\n');
            output.scrollTop = output.scrollHeight;
        }

        function clearConsole() {
            consoleLogs = [];
            updateConsole();
        }

        function showResult(testId, message, type = 'info') {
            const resultDiv = document.getElementById(testId);
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
        }

        // Teste 1: generatePixPayment
        async function testGeneratePixPayment() {
            try {
                console.log('üß™ Iniciando teste: generatePixPayment');

                // Simular clique no bot√£o de inscri√ß√£o
                if (typeof generatePixPayment === 'function') {
                    console.log('‚úÖ Fun√ß√£o generatePixPayment encontrada');

                    // Criar loading div simulado
                    const loadingDiv = document.createElement('div');
                    loadingDiv.id = 'pix-loading';
                    loadingDiv.innerHTML = '<div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.5);">Processando pagamento...</div>';
                    document.body.appendChild(loadingDiv);

                    // Executar fun√ß√£o
                    await generatePixPayment();

                    showResult('test1-result', '‚úÖ Teste generatePixPayment executado com sucesso! Verifique o console para detalhes.', 'success');
                } else {
                    showResult('test1-result', '‚ùå Fun√ß√£o generatePixPayment n√£o encontrada.', 'error');
                }
            } catch (error) {
                console.error('Erro no teste generatePixPayment:', error);
                showResult('test1-result', `‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        // Teste 2: fetchPixDetails com retry
        async function testFetchPixDetails() {
            try {
                console.log('üß™ Iniciando teste: fetchPixDetails com retry');

                if (typeof fetchPixDetails === 'function') {
                    console.log('‚úÖ Fun√ß√£o fetchPixDetails encontrada');

                    // Testar com um hash fict√≠cio para for√ßar retry/fallback
                    const testHash = 'TEST_' + Date.now();

                    await fetchPixDetails(testHash, 0);

                    showResult('test2-result', '‚úÖ Teste fetchPixDetails executado! Deve mostrar retry e fallback.', 'success');
                } else {
                    showResult('test2-result', '‚ùå Fun√ß√£o fetchPixDetails n√£o encontrada.', 'error');
                }
            } catch (error) {
                console.error('Erro no teste fetchPixDetails:', error);
                showResult('test2-result', `‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        // Teste 3: generateFallbackPix
        function testFallbackPix() {
            try {
                console.log('üß™ Iniciando teste: generateFallbackPix');

                if (typeof generateFallbackPix === 'function') {
                    console.log('‚úÖ Fun√ß√£o generateFallbackPix encontrada');

                    generateFallbackPix();

                    showResult('test3-result', '‚úÖ Sistema alternativo PIX ativado! Deve aparecer modal com QR Code.', 'success');
                } else {
                    showResult('test3-result', '‚ùå Fun√ß√£o generateFallbackPix n√£o encontrada.', 'error');
                }
            } catch (error) {
                console.error('Erro no teste generateFallbackPix:', error);
                showResult('test3-result', `‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        // Teste 4: showPixModal
        function testShowPixModal() {
            try {
                console.log('üß™ Iniciando teste: showPixModal');

                if (typeof showPixModal === 'function') {
                    console.log('‚úÖ Fun√ß√£o showPixModal encontrada');

                    // Dados de teste
                    const testPixData = {
                        id: 'TEST_MODAL_' + Date.now(),
                        hash: 'test_modal',
                        payment_status: 'pending',
                        amount: 6190,
                        pix_code: '00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-4266141740005204000053039865802BR5925CNH SOCIAL PAGAMENTO6009SAO PAULO62070503***6304ABCD',
                        qr_code_url: null,
                        fallback: false
                    };

                    showPixModal(testPixData);

                    showResult('test4-result', '‚úÖ Modal PIX exibido! Deve aparecer com QR Code e bot√£o de c√≥pia.', 'success');
                } else {
                    showResult('test4-result', '‚ùå Fun√ß√£o showPixModal n√£o encontrada.', 'error');
                }
            } catch (error) {
                console.error('Erro no teste showPixModal:', error);
                showResult('test4-result', `‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        // Teste 5: copyPixCode
        function testCopyPixCode() {
            try {
                console.log('üß™ Iniciando teste: copyPixCode');

                if (typeof copyPixCode === 'function') {
                    console.log('‚úÖ Fun√ß√£o copyPixCode encontrada');

                    const testCode = '00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-4266141740005204000053039865802BR5925CNH SOCIAL PAGAMENTO6009SAO PAULO62070503***6304ABCD';

                    // Criar elementos simulados
                    const pixCodeDiv = document.createElement('div');
                    pixCodeDiv.textContent = testCode;
                    pixCodeDiv.style.position = 'absolute';
                    pixCodeDiv.style.left = '-9999px';
                    document.body.appendChild(pixCodeDiv);

                    const button = document.createElement('button');
                    button.textContent = 'Copiar C√≥digo PIX';
                    document.body.appendChild(button);

                    copyPixCode(testCode, button);

                    // Limpar elementos de teste
                    setTimeout(() => {
                        document.body.removeChild(pixCodeDiv);
                        document.body.removeChild(button);
                    }, 1000);

                    showResult('test5-result', '‚úÖ Fun√ß√£o copyPixCode executada! Deve ter copiado para √°rea de transfer√™ncia.', 'success');
                } else {
                    showResult('test5-result', '‚ùå Fun√ß√£o copyPixCode n√£o encontrada.', 'error');
                }
            } catch (error) {
                console.error('Erro no teste copyPixCode:', error);
                showResult('test5-result', `‚ùå Erro no teste: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para executar todos os testes
        async function runAllTests() {
            console.log('üöÄ Iniciando bateria completa de testes do sistema PIX...');
            showResult('all-tests-result', '‚è≥ Executando testes... Aguarde os resultados no console.', 'info');

            const results = {
                passed: 0,
                failed: 0,
                total: 5
            };

            try {
                // Teste 1: generatePixPayment
                console.log('\nüß™ === TESTE 1: generatePixPayment ===');
                if (typeof generatePixPayment === 'function') {
                    console.log('‚úÖ Fun√ß√£o encontrada');
                    results.passed++;
                } else {
                    console.log('‚ùå Fun√ß√£o n√£o encontrada');
                    results.failed++;
                }

                // Teste 2: generateFallbackPix
                console.log('\nüß™ === TESTE 2: generateFallbackPix ===');
                if (typeof generateFallbackPix === 'function') {
                    generateFallbackPix();
                    console.log('‚úÖ Sistema alternativo executado');
                    results.passed++;
                } else {
                    console.log('‚ùå Fun√ß√£o n√£o encontrada');
                    results.failed++;
                }

                // Aguardar um pouco para o modal aparecer
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Teste 3: showPixModal
                console.log('\nüß™ === TESTE 3: showPixModal ===');
                if (typeof showPixModal === 'function') {
                    const testData = {
                        id: 'TEST_MODAL_' + Date.now(),
                        hash: 'test_modal',
                        payment_status: 'pending',
                        amount: 6190,
                        pix_code: '00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-4266141740005204000053039865802BR5925CNH SOCIAL PAGAMENTO6009SAO PAULO62070503***6304ABCD',
                        qr_code_url: null,
                        fallback: false
                    };
                    showPixModal(testData);
                    console.log('‚úÖ Modal exibido');
                    results.passed++;
                } else {
                    console.log('‚ùå Fun√ß√£o n√£o encontrada');
                    results.failed++;
                }

                // Teste 4: fetchPixDetails
                console.log('\nüß™ === TESTE 4: fetchPixDetails (Retry System) ===');
                if (typeof fetchPixDetails === 'function') {
                    const testHash = 'INVALID_' + Date.now();
                    fetchPixDetails(testHash, 0);
                    console.log('‚úÖ Sistema de retry iniciado');
                    results.passed++;
                } else {
                    console.log('‚ùå Fun√ß√£o n√£o encontrada');
                    results.failed++;
                }

                // Teste 5: copyPixCode
                console.log('\nüß™ === TESTE 5: copyPixCode ===');
                if (typeof copyPixCode === 'function') {
                    const testCode = '00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-4266141740005204000053039865802BR5925CNH SOCIAL PAGAMENTO6009SAO PAULO62070503***6304ABCD';
                    const testButton = document.createElement('button');
                    testButton.textContent = 'Teste';
                    testButton.style.position = 'absolute';
                    testButton.style.left = '-9999px';
                    document.body.appendChild(testButton);

                    copyPixCode(testCode, testButton);
                    setTimeout(() => document.body.removeChild(testButton), 1000);

                    console.log('‚úÖ Fun√ß√£o de c√≥pia executada');
                    results.passed++;
                } else {
                    console.log('‚ùå Fun√ß√£o n√£o encontrada');
                    results.failed++;
                }

                // Resultado final
                const successRate = ((results.passed / results.total) * 100).toFixed(1);
                const message = `‚úÖ Bateria de testes conclu√≠da!<br>
                üìä Resultados: ${results.passed}/${results.total} testes passaram (${successRate}%)<br>
                ‚úÖ Sucessos: ${results.passed}<br>
                ‚ùå Falhas: ${results.failed}<br>
                üîç Verifique o console e a interface para detalhes completos.`;

                showResult('all-tests-result', message, results.failed === 0 ? 'success' : 'error');

                console.log(`\nüéØ RESULTADO FINAL: ${results.passed}/${results.total} testes passaram (${successRate}%)`);

            } catch (error) {
                console.error('‚ùå Erro geral na bateria de testes:', error);
                showResult('all-tests-result', `‚ùå Erro na execu√ß√£o dos testes: ${error.message}`, 'error');
            }
        }

        // Executar testes automaticamente ao carregar a p√°gina
        window.addEventListener('load', async function() {
            console.log('üîç Verificando carregamento das fun√ß√µes PIX...');

            const functions = [
                'generatePixPayment',
                'fetchPixDetails',
                'generateFallbackPix',
                'showPixModal',
                'copyPixCode',
                'closePixModal',
                'handlePixError',
                'normalizeTransactionResponse',
                'hasPixInformation'
            ];

            let loadedFunctions = 0;
            functions.forEach(func => {
                if (typeof window[func] === 'function') {
                    console.log(`‚úÖ ${func} - Carregada`);
                    loadedFunctions++;
                } else {
                    console.log(`‚ùå ${func} - N√£o encontrada`);
                }
            });

            console.log(`üìä Fun√ß√µes carregadas: ${loadedFunctions}/${functions.length}`);

            // Aguardar um pouco para garantir que tudo est√° carregado
            await new Promise(resolve => setTimeout(resolve, 3000));

            // Executar bateria completa de testes automaticamente
            console.log('üöÄ Iniciando execu√ß√£o autom√°tica dos testes...');
            await runAllTests();
        });
    </script>
</body>
</html></content>
<parameter name="filePath">/Users/amandagoedert/Downloads/cnh/test-pix.html