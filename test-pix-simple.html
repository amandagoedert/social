<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste R√°pido PIX - CNH Social</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        h1 { color: #333; }
        .summary { background: white; padding: 20px; border-radius: 10px; margin: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <h1>üß™ Teste R√°pido do Sistema PIX</h1>
    <div id="results" class="summary">
        <h2>Resultados dos Testes</h2>
        <div id="test-output"></div>
    </div>

    <!-- Carregar os scripts do projeto -->
    <script src="js/polyfills-42372ed130431b0a.js"></script>
    <script src="js/webpack-305449aa8c860d36.js"></script>
    <script src="js/11eacf67-98aa3283aaa991d2.js"></script>
    <script src="js/954-f99233729901dfd9.js"></script>
    <script src="js/main-app-b38dfe386f18af4f.js"></script>
    <script src="js/528-e741b123adcbdc87.js"></script>
    <script src="js/page-2194861fd18157c8.js"></script>

    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            details: []
        };

        function addResult(testName, success, message) {
            testResults.total++;
            if (success) {
                testResults.passed++;
            } else {
                testResults.failed++;
            }

            testResults.details.push({
                name: testName,
                success: success,
                message: message,
                timestamp: new Date().toISOString()
            });

            updateDisplay();
        }

        function updateDisplay() {
            const output = document.getElementById('test-output');
            let html = `<h3>üìä Progresso: ${testResults.passed + testResults.failed}/${testResults.total} testes executados</h3>`;

            testResults.details.forEach(result => {
                const status = result.success ? '‚úÖ' : '‚ùå';
                const className = result.success ? 'success' : 'error';
                html += `<div class="test-result ${className}">${status} ${result.name}: ${result.message}</div>`;
            });

            if (testResults.total === 5) {
                const percentage = ((testResults.passed / testResults.total) * 100).toFixed(1);
                const finalStatus = testResults.failed === 0 ? 'success' : 'error';
                html += `<div class="test-result ${finalStatus}" style="font-weight: bold; font-size: 1.2em;">
                    üéØ RESULTADO FINAL: ${testResults.passed}/${testResults.total} testes passaram (${percentage}%)
                </div>`;
            }

            output.innerHTML = html;
        }

        // Executar testes automaticamente
        window.addEventListener('load', async function() {
            console.log('üöÄ Iniciando testes autom√°ticos do sistema PIX...');

            // Aguardar carregamento das fun√ß√µes
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Teste 1: Verificar se fun√ß√µes existem
            console.log('üß™ Teste 1: Verifica√ß√£o de fun√ß√µes PIX');
            const functions = ['generatePixPayment', 'fetchPixDetails', 'generateFallbackPix', 'showPixModal', 'copyPixCode'];
            let functionsFound = 0;

            functions.forEach(func => {
                if (typeof window[func] === 'function') {
                    functionsFound++;
                    console.log(`‚úÖ ${func} - OK`);
                } else {
                    console.log(`‚ùå ${func} - MISSING`);
                }
            });

            addResult('Verifica√ß√£o de Fun√ß√µes', functionsFound === functions.length,
                `${functionsFound}/${functions.length} fun√ß√µes encontradas`);

            // Teste 2: Sistema de fallback
            console.log('üß™ Teste 2: Sistema de Fallback');
            try {
                if (typeof generateFallbackPix === 'function') {
                    generateFallbackPix();
                    addResult('Sistema de Fallback', true, 'Fun√ß√£o executada sem erros');
                } else {
                    addResult('Sistema de Fallback', false, 'Fun√ß√£o n√£o encontrada');
                }
            } catch (error) {
                addResult('Sistema de Fallback', false, `Erro: ${error.message}`);
            }

            // Aguardar um pouco
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Teste 3: Modal PIX
            console.log('üß™ Teste 3: Modal PIX');
            try {
                if (typeof showPixModal === 'function') {
                    const testData = {
                        id: 'TEST_' + Date.now(),
                        pix_code: '00020126580014BR.GOV.BCB.PIX0136123e4567-e89b-12d3-a456-4266141740005204000053039865802BR5925CNH SOCIAL PAGAMENTO6009SAO PAULO62070503***6304ABCD',
                        amount: 6190
                    };
                    showPixModal(testData);
                    addResult('Modal PIX', true, 'Modal exibido com dados de teste');
                } else {
                    addResult('Modal PIX', false, 'Fun√ß√£o n√£o encontrada');
                }
            } catch (error) {
                addResult('Modal PIX', false, `Erro: ${error.message}`);
            }

            // Teste 4: Sistema de retry
            console.log('üß™ Teste 4: Sistema de Retry');
            try {
                if (typeof fetchPixDetails === 'function') {
                    fetchPixDetails('INVALID_HASH_' + Date.now(), 0);
                    addResult('Sistema de Retry', true, 'Sistema de retry iniciado');
                } else {
                    addResult('Sistema de Retry', false, 'Fun√ß√£o n√£o encontrada');
                }
            } catch (error) {
                addResult('Sistema de Retry', false, `Erro: ${error.message}`);
            }

            // Teste 5: Fun√ß√£o de c√≥pia
            console.log('üß™ Teste 5: Fun√ß√£o de C√≥pia');
            try {
                if (typeof copyPixCode === 'function') {
                    const testCode = 'PIX_TEST_CODE_' + Date.now();
                    const testButton = document.createElement('button');
                    testButton.style.position = 'absolute';
                    testButton.style.left = '-9999px';
                    document.body.appendChild(testButton);

                    copyPixCode(testCode, testButton);
                    document.body.removeChild(testButton);

                    addResult('Fun√ß√£o de C√≥pia', true, 'Fun√ß√£o executada (verificar √°rea de transfer√™ncia)');
                } else {
                    addResult('Fun√ß√£o de C√≥pia', false, 'Fun√ß√£o n√£o encontrada');
                }
            } catch (error) {
                addResult('Fun√ß√£o de C√≥pia', false, `Erro: ${error.message}`);
            }

            // Finalizar
            console.log(`üéØ Testes conclu√≠dos: ${testResults.passed}/${testResults.total} passaram`);

            // Salvar resultados
            saveResultsToFile();
        });

        async function saveResultsToFile() {
            try {
                const response = await fetch('http://localhost:8080/save-results', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        timestamp: new Date().toISOString(),
                        results: testResults,
                        userAgent: navigator.userAgent,
                        url: window.location.href
                    })
                });

                if (response.ok) {
                    console.log('üì° Resultados enviados para servidor!');
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Erro ao salvar resultados:', error.message);
            }
        }
    </script>
</body>
</html>